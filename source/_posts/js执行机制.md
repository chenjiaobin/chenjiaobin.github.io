---
title: js执行机制
date: 2018-01-29 13:30:08
tags: 
- Event Loop
- task queue
categories:
- 前端
- JS
---
js执行是单线程的，也就是同一时间只能干一件事。但是HTML5后面又提出了一个web workers的概念，它允许js创建多线程，但是子线程是被主线程控制的，子线程不能操作dom元素，这个新标准并没有改变js单线程的本质。<!--more-->
所有任务可以分为同步任务和异步任务
- 同步任务：在主线程上执行的任务，只有当上一个任务结束后才能执行下一个任务
- 异步任务：这里的任务没有进入主线程，而是在任务队列里面，只有当**任务队列**通知主线程的时候，这个异步任务才会进入主线程进行执行
### 异步执行的运行机制
- 所有同步任务在主线程里面执行，形成一个**执行栈**
- 主线程之外还有一个**任务队列(task queue)**,只要异步任务有了运行结构，就在“任务队列里面放置一个事件”
- 一旦“执行栈”所有同步任务执行结束后，系统就会读取“任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行
- 主线程不断重复上面的第三步
### Event Loop
主线程从“任务队列”中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event LOOP(事件循环)
### repaint(重绘)和reflow(回流)
- reflow:这个几乎是无法避免的，即某个子元素样式发生改变，直接影响到了其父元素以及往上追溯很多祖先元素包括兄弟元素，这个时候浏览器要重新渲染这个子元素相关联的所有元素的过程称为**回流**
- repaint:这个就是改变子元素不影响到父元素的另一种叫法，叫**重绘**
注意：repaint速度明显快于reflow

### 参考文章
- [文章1](https://www.cnblogs.com/MasterYao/p/5563725.html)
