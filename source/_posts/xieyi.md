---
title: TCP/IP协议族
date: 2017-09-13 23:10:00
tags: 
- TCP/IP
- HTTP
categories:
- 前端
- TCP/IP
---
TCP/IP指的是网络通信协议，由网络层的IP协议和传输层的TCP协议组成。简单的说就是，他就是来解决电脑之间的通信的语言障碍，彼此有共同的语言进行交互。<!--more-->
**注**：TCP协议不是一个协议，是一个协议族的统称，包括TCP协议、IP协议、IMCP协议、HTTP协议、FTP协议、POP3协议
### 知识点
* IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。意思就是限制每一次连接只处理一个请求，服务器处理完客户的请求后，并收到客户的
应答后，即断开连接，节省传输时间，http1.1实现了持续连接的功能。IP 负责将每个包路由至它的目的地。
* TCP 用于应用程序之间的通信，UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。
TCP/IP 意味着 TCP 和 IP 在一起协同工作。
TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。
IP 负责计算机之间的通信。
TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。
IP 负责将包发送至接受者
### TCP的三次握手
所谓三次握手就是TCP的连接，指建立一个TCP连接需要客户端和服务器端总共发起3个包以确认连接建立，在socket编程中，这一过程由客户端执行connect来触发
（1）第一次握手：Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。
（2）第二次握手：Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。
（3）第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。

简单来说，就是
1. 建立连接时，客户端发送SYN包（SYN=i）到服务器，并进入到SYN-SEND状态，等待服务器确认
2. 服务器收到SYN包，必须确认客户的SYN（ack=i+1）,同时自己也发送一个SYN包（SYN=k）,即SYN+ACK包，此时服务器进入SYN-RECV状态
3. 客户端收到服务器的SYN+ACK包，向服务器发送确认报ACK（ack=k+1）,此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手，客户端与服务器开始传送数据。
### SYN攻击：
在三次握手过程中，Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接称为半连接（half-open connect），此时Server处于SYN_RCVD状态，
当收到ACK后，Server转入ESTABLISHED状态。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server回复确认包，
并等待Client的确认，由于源地址是不存在的，因此，Server需要不断重发直至超时，这些伪造的SYN包将产时间占用未连接队列，导致正常的SYN请求因为队列满而
被丢弃，从而引起网络堵塞甚至系统瘫痪。SYN攻击时一种典型的DDOS攻击，检测SYN攻击的方式非常简单，即当Server上有大量半连接状态且源IP地址是随机的，则
可以断定遭到SYN攻击了
### TCP四次握手
TCP四次握手即终止TCP连接，指断开TCP连接需要客户端和服务器端总共发送4个包来确认连接的断开，在socket编程中，这一过程由客户端或服务端任一方执行close来触发
由于TCP连接时全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，收到一个FIN只是意味着这一方向上没有数据流动了，即不会再收到数据了，但是在这个TCP连接上仍然能够发送数据，直到这一方向也发送了FIN。首先进行关闭的一方将执行主动关闭，而另一方则执行被动关闭，上图描述的即是如此。
（1）第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。
（2）第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。
（3）第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。
（4）第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。
### 为什么建立连接是三次握手，而关闭连接却是四次挥手呢？

这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，
仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送
FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。

### HTTP协议详解
* 无连接：意思就是限制每一次连接只处理一个请求，服务器处理完客户的请求后，并收到客户的应答后，即断开连接，节省传输时间，http1.1实现了持续连接的功能
* 无状态：指协议对于事务没有记忆能力，在次请求同样的资源必须重新访问服务器
* URL是特定类型的uri:
URL组成，协议+资源主机IP地址+主机资源的具体地址
URI组成，访问资源的命名机制+存放资源的主机名+资源自身的名称
URI是以一种抽象的，高层次概念定义统一资源标识，而URL和URN则是具体的资源标识的方式。URL和URN都是一种URI。笼统地说，每个 URL 都是 URI，但不一定每个 URI 都是 URL。这是因为 URI 还包括一个子类，即统一资源名称 (URN)，它命名资源但不指定如何定位资源。
* 一个http请求包括：请求行、请求头、空格、请求主体
    响应则包括：状态行、消息报头、空行、响应正文
** 客户端到服务器端的访问流程 **
例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：
1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5、释放 TCP连接;


6、浏览器将该 html 文本并显示内容;
参考文章[地址1](http://www.jianshu.com/p/ef892323e68f)
作者:陈焦滨#kevin


